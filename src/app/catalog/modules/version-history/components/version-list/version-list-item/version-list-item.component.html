<ng-container *ngIf="active; else notCurrentVersionTemplate">
  <div class="current-version-header">
    <h4>{{'common.currentVersion' | translate}}</h4>
    <ng-container *ngTemplateOutlet="menuBtnTemplate;"></ng-container>
  </div>
  <div class="version-info current-version">
    <time>{{version.changedAt | date : dateFormat}}</time>
    <i *ngIf="autosaving"> ({{'common.autosaving' | translate}})</i>
    <ng-container *ngTemplateOutlet="userTemplate;"></ng-container>
  </div>
</ng-container>
<ng-template #notCurrentVersionTemplate>
  <div
    #itemRef
    class="version-info"
    [ngClass]="{
      'no-menu': type === eHistoryType.START_AND_STOP_HISTORY,
      'focused': focused
    }">
    <div class="version-info_header">
      <h4>{{version.title}}</h4>
      <mat-icon
        @fadeInOut
        *ngIf="version.launched">
        <svg width="110" height="24" viewBox="0 0 110 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="110" height="24" rx="12" fill="#EBF9EE"/>
          <path
            d="M29.879 15.3808C30.5623 15.8932 31.4377 16.1281 32.5267 16.1281C33.5516 16.1281 34.4057 15.9146 35.0676 15.4448C35.7295 14.9751 36.0712 14.3772 36.0712 13.6512C36.0712 13.2242 35.9431 12.8185 35.6868 12.4555C35.4306 12.1139 35.1103 11.879 34.7046 11.7509V11.6014C35.0249 11.516 35.3025 11.2811 35.5374 10.9181C35.7722 10.5765 35.9004 10.1922 35.9004 9.76512C35.9004 9.03915 35.5801 8.46263 34.9609 8.01423C34.3203 7.56584 33.5089 7.33096 32.484 7.33096C31.5018 7.33096 30.669 7.56584 29.9858 8.01423C29.3025 8.46263 28.8541 9.0605 28.6406 9.80783H29.9004C30.1139 9.38078 30.4342 9.0605 30.8826 8.80427C31.3096 8.56939 31.8434 8.44128 32.484 8.44128C33.1673 8.44128 33.7011 8.56939 34.1068 8.82562C34.5125 9.08185 34.726 9.44484 34.726 9.87189C34.726 10.2776 34.5765 10.5979 34.2776 10.8541C33.9786 11.1103 33.5943 11.2171 33.1673 11.1957H31.4804V12.242H33.1673C33.6584 12.242 34.0641 12.3701 34.3843 12.6263C34.7046 12.8826 34.8754 13.2028 34.8754 13.6085C34.8754 14.0783 34.6619 14.4199 34.2562 14.6548C33.8292 14.911 33.274 15.0178 32.5694 15.0178C31.8434 15.0178 31.2242 14.8897 30.7544 14.5907C30.2847 14.2918 29.9644 13.9075 29.7936 13.395H28.5765C28.7473 14.2278 29.1957 14.8897 29.879 15.3808ZM41.6009 9.59431H37.7788V10.5979H41.4941C41.7717 10.5979 41.9212 10.7473 41.9212 11.0249V12.242H39.6151C38.8251 12.242 38.2272 12.4128 37.8002 12.7544C37.3731 13.0961 37.181 13.5658 37.181 14.1637C37.181 14.7402 37.3731 15.21 37.8002 15.573C38.2272 15.9573 38.761 16.1281 39.4229 16.1281C39.9354 16.1281 40.4052 16.0427 40.7895 15.8505C41.1738 15.6797 41.5155 15.3808 41.8358 14.9751H41.9852V16H42.9674V10.9609C42.9674 10.5552 42.8393 10.2349 42.5831 9.97865C42.3269 9.72242 42.0066 9.59431 41.6009 9.59431ZM41.2165 14.6121C40.7895 14.9964 40.2343 15.1886 39.5938 15.1886C39.1881 15.1886 38.8678 15.1032 38.6116 14.911C38.3553 14.7189 38.2486 14.4626 38.2486 14.1423C38.2486 13.8007 38.3553 13.5658 38.5689 13.395C38.7824 13.2456 39.1454 13.1601 39.6365 13.1601H41.9212C41.8785 13.758 41.6436 14.2278 41.2165 14.6121ZM50.6932 9.59431H45.1416V16H46.2092V10.6192H49.6256V16H50.6932V9.59431ZM57.7581 9.59431L55.6869 14.9324H55.5374L53.2527 9.59431H52.057L55.0677 16.427L54.8755 16.9181C54.7901 17.1103 54.726 17.2384 54.6833 17.2811C54.6193 17.3238 54.5552 17.3452 54.4698 17.3452H52.6549V18.3488H54.4912C54.8542 18.3488 55.1317 18.2633 55.3239 18.0925C55.5161 17.9217 55.7296 17.5374 55.9645 16.9822L58.8897 9.59431H57.7581ZM68.9663 9.59431H67.8987V14.9751H65.1229V9.59431H64.0553V14.9751H61.2795V9.59431H60.2119V16H68.8169V17.4947H69.8631V14.9751H68.9663V9.59431ZM71.8467 13.1601H77.3556C77.3556 13.0747 77.377 12.968 77.377 12.7972C77.377 12.1993 77.2275 11.6228 76.9286 11.1103C76.6296 10.5979 76.2453 10.2135 75.7328 9.91459C75.2204 9.61566 74.6652 9.46619 74.0674 9.46619C73.4481 9.46619 72.893 9.61566 72.3805 9.91459C71.8681 10.2135 71.4837 10.5979 71.1848 11.1103C70.8859 11.6228 70.7578 12.1993 70.7578 12.7972C70.7578 13.4377 70.8859 13.9929 71.1848 14.5053C71.4837 15.0178 71.8894 15.4021 72.4019 15.7011C72.9143 16 73.4909 16.1281 74.1741 16.1281C74.836 16.1281 75.4339 15.9786 75.9677 15.6584C76.5015 15.3381 76.8859 14.911 77.1207 14.3986H75.9037C75.7328 14.6335 75.498 14.8043 75.199 14.9324C74.9001 15.0605 74.5585 15.1246 74.1955 15.1246C73.5336 15.1246 72.9997 14.9537 72.5727 14.5907C72.1457 14.2278 71.9108 13.758 71.8467 13.1601ZM72.6581 10.9609C73.0638 10.6192 73.5336 10.4484 74.0674 10.4484C74.5798 10.4484 75.0496 10.6192 75.4553 10.9609C75.861 11.3025 76.1172 11.7295 76.2453 12.242H71.8894C71.9962 11.7295 72.2524 11.3025 72.6581 10.9609ZM83.6099 12.2847H80.1936V9.59431H79.1259V16H80.1936V13.3096H83.6099V16H84.6775V9.59431H83.6099V12.2847ZM88.4328 16L91.4222 10.79H91.5716V16H92.6179V9.59431H91.0805L88.0912 14.8043H87.9417V9.59431H86.8955V16H88.4328ZM96.3782 16L99.3675 10.79H99.5169V16H100.563V9.59431H99.0258L96.0365 14.8043H95.8871V9.59431H94.8408V16H96.3782ZM96.2927 8.20641C96.6557 8.50534 97.1255 8.6548 97.702 8.6548C98.2572 8.6548 98.7269 8.50534 99.0899 8.20641C99.4529 7.90747 99.6451 7.50178 99.6451 7.03203H98.7056C98.7056 7.28826 98.5988 7.48043 98.428 7.62989C98.2358 7.77936 98.0009 7.84342 97.702 7.84342C97.4031 7.84342 97.1468 7.77936 96.976 7.62989C96.7838 7.48043 96.6984 7.28826 96.6984 7.03203H95.7589C95.7589 7.50178 95.9298 7.90747 96.2927 8.20641Z"
            fill="#34C759"/>
          <path
            d="M11.2862 17.9316C11.3701 17.9773 11.4629 18 11.5556 18C11.6579 18 11.7601 17.9723 11.85 17.9171L20.7389 12.4626C20.9013 12.3629 21 12.1881 21 12C21 11.812 20.9013 11.6372 20.7389 11.5375L11.85 6.08292C11.6787 5.9778 11.4629 5.97227 11.2862 6.06838C11.1096 6.16452 11 6.34718 11 6.54547V17.4545C11 17.6528 11.1096 17.8355 11.2862 17.9316Z"
            fill="#34C759"/>
        </svg>
      </mat-icon>
      <ng-container *ngIf="type === eHistoryType.VERSION_HISTORY">
        <ng-container *ngTemplateOutlet="menuBtnTemplate;"></ng-container>
      </ng-container>
    </div>
    <p *ngIf="version.description">{{version.description}}</p>
    <ng-container *ngTemplateOutlet="userTemplate;"></ng-container>
    <time>{{version.changedAt | date : dateFormat}}</time>
  </div>
</ng-template>

<ng-template
  #userTemplate>
  <div
    class="user"
    *ngIf="version.author as username">
    <np-avatar
      [data]="username | acronym : 2"
      [type]="'initials'"
      npUserInfoTooltip
      [npUserInfoTooltipUsername]="username">
    </np-avatar>
    <span>
      {{username}}
    </span>
  </div>
</ng-template>

<ng-template
  #menuBtnTemplate>
  <button
    *ngIf="!isLocked"
    mat-button
    class="min-width-auto menu-dots"
    [ngClass]="{
      'menu-opened': menuTrigger.menuOpen
    }"
    [matMenuTriggerFor]="menu"
    #menuTrigger="matMenuTrigger">
    <mat-icon>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M12 8C13.1 8 14 7.1 14 6C14 4.9 13.1 4 12 4C10.9 4 10 4.9 10 6C10 7.1 10.9 8 12 8ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10ZM12 16C10.9 16 10 16.9 10 18C10 19.1 10.9 20 12 20C13.1 20 14 19.1 14 18C14 16.9 13.1 16 12 16Z"
          fill="#B8C1CB"/>
      </svg>
    </mat-icon>
  </button>
</ng-template>

<mat-menu
  #menu="matMenu">
  <button
    *ngIf="!active"
    mat-menu-item
    (click)="openVersion()">
    {{'common.open' | translate}}
  </button>
  <!--<button
    mat-menu-item
    (click)="launchVersion()"
    [disabled]="true">
    {{'common.launchVersion' | translate}}
  </button>-->
  <button
    mat-menu-item
    (click)="showDetails()">
    {{'common.showDetails' | translate}}
  </button>
</mat-menu>
