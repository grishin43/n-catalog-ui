<div class="mat-table-wrapper">
  <mat-table
    [dataSource]="dataSource"
    [ngClass]="tableClass">
    <ng-container
      *ngFor="let col of displayedColumns"
      [matColumnDef]="col?.name">
      <mat-header-cell
        *matHeaderCellDef
        [ngStyle]="{'flex-basis':col?.width, 'max-width':col?.width}">
        {{col?.text | translate}}
      </mat-header-cell>
      <mat-cell
        *matCellDef="let row"
        [ngStyle]="{'flex-basis':col?.width, 'max-width':col?.width}">
        <ng-container [ngSwitch]="col?.type">

          <ng-container *ngSwitchCase="tableDataType.PROCESS">
            <span class="entity-row">
              <ng-container *ngIf="row?.type === catalogEntityType.PROCESS">
              <mat-icon>
                <svg width="36" height="40" viewBox="0 0 36 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g filter="url(#filter0_d)">
                    <path
                      d="M5.99998 3.5H21.9287C23.1221 3.5 24.2667 3.97409 25.1106 4.81797L30.1819 9.88908C31.0258 10.733 31.4999 11.8776 31.4999 13.0711V33C31.4999 33.8287 30.828 34.5 30 34.5H5.99998C5.17194 34.5 4.5 33.8287 4.5 33V4.99998C4.5 4.17133 5.17203 3.5 5.99998 3.5Z"
                      fill="white" stroke="#E7EDF5"/>
                  </g>
                  <g clip-path="url(#clip0)">
                    <path
                      d="M17.9997 27C22.418 27 25.9997 23.4183 25.9997 19C25.9997 14.5817 22.418 11 17.9997 11C13.5814 11 9.99969 14.5817 9.99969 19C9.99969 23.4183 13.5814 27 17.9997 27Z"
                      fill="url(#paint0_linear)"/>
                    <path
                      d="M21.7506 20.0194L22.8734 20.023V17.9967L21.7626 17.9943C21.6777 17.6779 21.553 17.3736 21.3914 17.0887L22.1749 16.3142L20.7423 14.8751L19.9576 15.6496C19.6724 15.4836 19.3666 15.3559 19.0481 15.2698L19.0518 14.1767H17.0045L17.0105 15.2594C16.6928 15.3437 16.387 15.4679 16.1005 15.6291L15.3416 14.8678L13.894 16.2919L14.6534 17.0538C14.5709 17.195 14.4974 17.3413 14.4335 17.4919C14.3698 17.6425 14.316 17.797 14.2726 17.9546L13.1725 17.9487V19.973L14.2605 19.9797C14.3452 20.2968 14.4701 20.6018 14.6324 20.8871L13.8315 21.6756L15.2651 23.1142L16.0653 22.3257C16.3509 22.4914 16.6569 22.6192 16.9754 22.7061V23.8502L19.0106 23.849V22.717C19.3298 22.6328 19.6368 22.508 19.9243 22.3458L20.7245 23.1418L22.1731 21.72L21.3703 20.9202C21.5351 20.6375 21.663 20.3348 21.7506 20.0195V20.0194ZM18.023 21.6945C17.4927 21.6945 16.9743 21.5373 16.5334 21.2427C16.0925 20.9481 15.7489 20.5293 15.546 20.0394C15.3431 19.5495 15.29 19.0105 15.3934 18.4904C15.4969 17.9703 15.7522 17.4926 16.1272 17.1176C16.5021 16.7427 16.9798 16.4873 17.4999 16.3839C18.02 16.2804 18.5591 16.3335 19.049 16.5364C19.5389 16.7394 19.9576 17.083 20.2522 17.5239C20.5468 17.9648 20.7041 18.4832 20.7041 19.0134C20.7041 19.7245 20.4216 20.4064 19.9188 20.9092C19.416 21.412 18.734 21.6945 18.023 21.6945Z"
                      fill="white"/>
                  </g>
                  <defs>
                    <filter id="filter0_d" x="0" y="0" width="35.9999" height="40" filterUnits="userSpaceOnUse"
                            color-interpolation-filters="sRGB">
                      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
                      <feOffset dy="1"/>
                      <feGaussianBlur stdDeviation="2"/>
                      <feColorMatrix type="matrix"
                                     values="0 0 0 0 0.283038 0 0 0 0 0.412791 0 0 0 0 0.495833 0 0 0 0.13 0"/>
                      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
                      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
                    </filter>
                    <linearGradient id="paint0_linear" x1="9.99969" y1="27" x2="25.9997" y2="27"
                                    gradientUnits="userSpaceOnUse">
                      <stop stop-color="#FF1E00"/>
                      <stop offset="1" stop-color="#FF8B00"/>
                    </linearGradient>
                    <clipPath id="clip0">
                      <rect width="16" height="16" fill="white" transform="translate(9.99969 11)"/>
                    </clipPath>
                  </defs>
                </svg>
              </mat-icon>
              </ng-container>
              <ng-container *ngIf="row?.type === catalogEntityType.FOLDER">
                <mat-icon *ngIf="!row?.hasSubFolders">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip1)">
                      <path
                        d="M10.59 5.12688C10.21 4.72313 9.7 4.5 9.17 4.5H4C2.9 4.5 2.01 5.45625 2.01 6.625L2 19.375C2 20.5438 2.9 21.5 4 21.5H20C21.1 21.5 22 20.5438 22 19.375V8.75C22 7.58125 21.1 6.625 20 6.625H12L10.59 5.12688Z"
                        fill="#B6B8DC"/>
                    </g>
                    <defs>
                      <clipPath id="clip1">
                        <rect width="24" height="24" fill="white"/>
                      </clipPath>
                    </defs>
                  </svg>
                </mat-icon>
                <mat-icon *ngIf="row?.hasSubFolders">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip2)">
                      <path
                        d="M19.5294 7.17183H10.8706L9.89203 5.62126C9.648 5.23457 9.2216 4.98224 8.76581 5.01889H1.92706C0.86047 5.02666 0 5.89348 0 6.96007V19.5507C0.00129412 20.6209 0.868588 21.4882 1.93882 21.4895H19.5294C20.5996 21.4882 21.4669 20.6209 21.4682 19.5507V9.11066C21.4669 8.04042 20.5996 7.17313 19.5294 7.17183Z"
                        fill="#B6B8DC"/>
                      <path
                        d="M22.073 4.66358H13.4118L11.6895 2.61652C11.6315 2.54688 11.5447 2.50782 11.4542 2.51064H4.47066C3.50289 2.51223 2.68454 3.22717 2.55301 4.18594H8.92242C9.25642 4.18511 9.57354 4.33252 9.7883 4.58829L11 6.33652H19.5295C21.0592 6.33911 22.2987 7.57858 22.3012 9.10829V18.9624C23.2711 18.8414 23.9993 18.0175 24.0001 17.0401V6.60005C23.9975 5.53529 23.1377 4.67135 22.073 4.66358Z"
                        fill="#B6B8DC"/>
                    </g>
                    <defs>
                      <clipPath id="clip2">
                        <rect width="24" height="24" fill="white"/>
                      </clipPath>
                    </defs>
                  </svg>
                </mat-icon>
              </ng-container>
              <ng-container
                *ngIf="(tableActions.renameLoader | async) === row?.id; else entityNameTemplate">
                <span class="entity-name">
                 {{'common.renaming' | translate}}
                </span>
                <mat-spinner
                  style="margin-left: 8px"
                  [diameter]="20">
                </mat-spinner>
              </ng-container>
              <ng-template #entityNameTemplate>
                 <span class="entity-name">
                  {{row?.name || '-'}}
                 </span>
              </ng-template>
              </span>
          </ng-container>

          <ng-container *ngSwitchCase="tableDataType.PARTICIPANTS">
            <np-persons
              [persons]="row[col?.name]"
              [entityOwner]="row.owner"
              [active]="row.editingBy">
            </np-persons>
          </ng-container>

          <ng-container *ngSwitchCase="tableDataType.DATE">
            {{row[col?.name] | date : 'dd.MM.yyyy'}}
          </ng-container>

          <ng-container *ngSwitchCase="tableDataType.STATUS">
            <ng-container
              *ngIf="row.permissions !== entityPermission.NO_ACCESS">
              <ng-container *ngIf="row?.type === catalogEntityType.PROCESS">
                <np-status-pill
                  [status]="row[col?.name]">
                </np-status-pill>
              </ng-container>
            </ng-container>
          </ng-container>

          <ng-container *ngSwitchCase="tableDataType.ACTIONS">
            <ng-container
              *ngIf="row.permissions !== entityPermission.NO_ACCESS; else requestAccessTemp">
              <ng-container *ngIf="row?.type === catalogEntityType.PROCESS || row?.type === catalogEntityType.FOLDER">
                <button mat-icon-button
                        (click)="$event.preventDefault(); $event.stopPropagation();"
                        [matMenuTriggerFor]="menu">
                  <mat-icon>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M12 8C13.1 8 14 7.1 14 6C14 4.9 13.1 4 12 4C10.9 4 10 4.9 10 6C10 7.1 10.9 8 12 8ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10ZM12 16C10.9 16 10 16.9 10 18C10 19.1 10.9 20 12 20C13.1 20 14 19.1 14 18C14 16.9 13.1 16 12 16Z"
                        fill="#B8C1CB"/>
                    </svg>
                  </mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <ng-container *ngIf="row.type === catalogEntityType.PROCESS; else folder">
                    <ng-container *ngFor="let action of processActions">
                      <ng-container
                        *ngTemplateOutlet="rowActionButton; context: {action: action, entity: row}"></ng-container>
                    </ng-container>
                  </ng-container>
                  <ng-template #folder>
                    <ng-container *ngFor="let action of folderActions">
                      <ng-container
                        *ngTemplateOutlet="rowActionButton; context: {action: action, entity: row}"></ng-container>
                    </ng-container>
                  </ng-template>
                </mat-menu>
              </ng-container>
            </ng-container>
            <ng-template #requestAccessTemp>
              <np-button
                [type]="'secondary'"
                [size]="'sm'"
                (click)="requestEntityTemplate(row)">
                {{'common.requestPermission' | translate}}
              </np-button>
            </ng-template>
          </ng-container>

          <ng-container *ngSwitchCase="tableDataType.TRANSLATION">
            <ng-container *ngIf="col?.name === entityTableColumnName.PERMISSIONS; else defaultTranslation">
              <mat-icon class="d-xl-none">
                <ng-container *ngIf="row[col?.name] === entityPermission.EDITOR">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M2.5 14.5499V17.0832C2.5 17.3166 2.68333 17.4999 2.91667 17.4999H5.45C5.55833 17.4999 5.66667 17.4582 5.74167 17.3749L14.8417 8.28322L11.7167 5.15822L2.625 14.2499C2.54167 14.3332 2.5 14.4332 2.5 14.5499ZM17.2583 5.86655C17.5833 5.54155 17.5833 5.01655 17.2583 4.69155L15.3083 2.74155C14.9833 2.41655 14.4583 2.41655 14.1333 2.74155L12.6083 4.26655L15.7333 7.39155L17.2583 5.86655Z"
                      fill="#8A95A3"/>
                  </svg>
                </ng-container>
                <ng-container *ngIf="row[col?.name] === entityPermission.VIEWER">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M10 4.99992C13.1583 4.99992 15.975 6.77492 17.35 9.58325C15.975 12.3916 13.1583 14.1666 10 14.1666C6.84166 14.1666 4.025 12.3916 2.65 9.58325C4.025 6.77492 6.84166 4.99992 10 4.99992ZM10 3.33325C5.83333 3.33325 2.275 5.92492 0.833332 9.58325C2.275 13.2416 5.83333 15.8333 10 15.8333C14.1667 15.8333 17.725 13.2416 19.1667 9.58325C17.725 5.92492 14.1667 3.33325 10 3.33325ZM10 7.49992C11.15 7.49992 12.0833 8.43325 12.0833 9.58325C12.0833 10.7333 11.15 11.6666 10 11.6666C8.85 11.6666 7.91666 10.7333 7.91666 9.58325C7.91666 8.43325 8.85 7.49992 10 7.49992ZM10 5.83325C7.93333 5.83325 6.25 7.51659 6.25 9.58325C6.25 11.6499 7.93333 13.3333 10 13.3333C12.0667 13.3333 13.75 11.6499 13.75 9.58325C13.75 7.51659 12.0667 5.83325 10 5.83325Z"
                      fill="#8A95A3"/>
                  </svg>
                </ng-container>
                <ng-container *ngIf="row[col?.name] === entityPermission.NO_ACCESS">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M15 6.66658H14.1667V4.99992C14.1667 2.69992 12.3 0.833252 10 0.833252C7.7 0.833252 5.83333 2.69992 5.83333 4.99992V6.66658H5C4.08333 6.66658 3.33333 7.41658 3.33333 8.33325V16.6666C3.33333 17.5833 4.08333 18.3333 5 18.3333H15C15.9167 18.3333 16.6667 17.5833 16.6667 16.6666V8.33325C16.6667 7.41658 15.9167 6.66658 15 6.66658ZM7.5 4.99992C7.5 3.61659 8.61666 2.49992 10 2.49992C11.3833 2.49992 12.5 3.61659 12.5 4.99992V6.66658H7.5V4.99992ZM15 16.6666H5V8.33325H15V16.6666ZM10 14.1666C10.9167 14.1666 11.6667 13.4166 11.6667 12.4999C11.6667 11.5833 10.9167 10.8333 10 10.8333C9.08333 10.8333 8.33333 11.5833 8.33333 12.4999C8.33333 13.4166 9.08333 14.1666 10 14.1666Z"
                      fill="#8A95A3"/>
                  </svg>
                </ng-container>
              </mat-icon>
              <span class="d-xl-block d-none">
                {{'common.' + row[col?.name] | translate}}
              </span>
            </ng-container>
            <ng-template #defaultTranslation>
              {{'common.' + row[col?.name] | translate}}
            </ng-template>
          </ng-container>

          <ng-container *ngSwitchDefault>
            {{row[col?.name]}}
          </ng-container>

        </ng-container>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns | toStringArray : 'name'; sticky: true"></mat-header-row>

    <mat-row
      matRipple
      [matRippleColor]="rippleLightColor"
      [matRippleDisabled]="row.permissions === entityPermission.NO_ACCESS || (tableActions.renameLoader | async) === row?.id"
      (click)="openItem(row)"
      [ngClass]="{
        'blocked': row.permissions === entityPermission.NO_ACCESS,
        'disabled': (tableActions.renameLoader | async) === row?.id
      }"
      *matRowDef="let row; columns: displayedColumns | toStringArray : 'name';">
    </mat-row>

  </mat-table>
</div>


<ng-template
  #rowActionButton
  let-action="action"
  let-entity="entity">
  <ng-container
    *ngIf="
    entity.type === catalogEntityType.PROCESS
    && (action.name === eCatalogEntityAction.RENAME || action.name === eCatalogEntityAction.DELETE)
    && entity.permissions !== entityPermission.OWNER;
    else otherActionButton">
  </ng-container>
  <ng-template #otherActionButton>
    <button
      mat-menu-item
      [ngClass]="action.class"
      [disabled]="action.disabled"
      (click)="action.cb(entity, parentFolder, entityRenamedSsCb)">
      {{'common.' + action.name | translate}}
    </button>
  </ng-template>
</ng-template>
